<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Scratch 'N' Eat â€“ Instant Win Scratch Card</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Common Ninja script -->
  <script src="https://cdn.commoninja.com/sdk/latest/commonninja.js" defer></script>

  <style>
    :root {
      --red: #EE2E1E;
      --cream: #fff7e6;
      --dark: #222;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: var(--cream);
      color: var(--dark);
    }

    /* HERO */
    .hero-header {
      background: var(--red);
      color: var(--cream);
      padding: 48px 20px 32px;
      text-align: center;
    }

    .hero-logo {
      width: 320px;
      max-width: 85vw;
      margin: 0 auto;
      opacity: 0;
      animation: fadeIn 1.3s ease forwards;
    }

    .tagline {
      font-size: 1.4rem;
      font-weight: 700;
      margin-top: 14px;
      opacity: 0;
      animation: fadeIn 1.4s ease forwards 0.25s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    main {
      max-width: 760px;
      margin: 24px auto 40px;
      padding: 0 16px 40px;
    }

    .card {
      background: #fff;
      border-radius: 18px;
      padding: 22px 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }

    .biz-logo {
      display: block;
      margin: 8px auto 16px;
      width: 70%;
      max-width: 260px;
    }

    .widget-instance { display: none; }

    .scratch-lock {
      position: absolute;
      inset: 0;
      background: rgba(255,247,230,0.96);
      padding: 20px;
      border-radius: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-weight: 600;
      z-index: 20;
    }
  </style>
</head>

<body>

<header class="hero-header">
  <img src="Scratch 'N' Eat Logo Design.png" class="hero-logo" alt="Logo">
  <p class="tagline">Scratch. Win. Eat.</p>
</header>

<main>

  <!-- STEP 1 -->
  <section class="card" id="selector-section">
    <h2>Find your takeaway</h2>

    <form id="selector-form">
      <label>Town *</label>
      <select id="town" required>
        <option value="">Select your town</option>
        <option value="Bangor">Bangor</option>
      </select>

      <label>Cuisine *</label>
      <select id="cuisine" required>
        <option value="">Select cuisine</option>
        <option value="Indian">Indian</option>
      </select>

      <label>Business *</label>
      <select id="business" required>
        <option value="">Select business</option>
      </select>

      <button type="submit">Continue</button>
    </form>
  </section>

  <!-- STEP 2 -->
  <section class="card hidden" id="widget-section">
    <h2>Scratch & Win â€“ <span id="widget-business-name"></span></h2>

    <img id="biz-logo" class="biz-logo" alt="Business Logo">

    <p><strong>Sign up or sign in to play:</strong></p>

    <div class="cn-wrapper" style="margin-bottom: 12px;">
      <div class="commonninja_component pid-db61f090-e9fa-4a14-9388-05403a74f5db"></div>
    </div>

    <p>Then scratch below to reveal your prize:</p>

    <div class="cn-wrapper" style="min-height:320px; position:relative;">

      <div id="scratch-lock" class="scratch-lock">
        Please sign in above to unlock the scratch card.
      </div>

      <div id="widget-starofbengal"
           class="commonninja_component pid-a681398a-7a0d-4da8-90d1-598d4137f6f5 widget-instance"></div>

      <div id="widget-greenchilli"
           class="commonninja_component pid-a681398a-7a0d-4da8-90d1-598d4137f6f5 widget-instance"></div>
    </div>
  </section>

</main>

<script>
  const townSelect = document.getElementById("town");
  const cuisineSelect = document.getElementById("cuisine");
  const businessSelect = document.getElementById("business");
  const widgetSection = document.getElementById("widget-section");
  const widgetBizName = document.getElementById("widget-business-name");
  const bizLogo = document.getElementById("biz-logo");

  const widgetStar = document.getElementById("widget-starofbengal");
  const widgetGreen = document.getElementById("widget-greenchilli");

  const businessData = {
    "Bangor": {
      "Indian": ["Star Of Bengal", "Green Chilli"]
    }
  };

  function updateBusinessDropdown() {
    const town = townSelect.value;
    const cuisine = cuisineSelect.value;
    const businesses = businessData[town]?.[cuisine] || [];

    businessSelect.innerHTML = `<option value="">Select business</option>`;
    businesses.forEach(b => {
      const opt = document.createElement("option");
      opt.value = b;
      opt.textContent = b;
      businessSelect.appendChild(opt);
    });
  }

  townSelect.addEventListener("change", updateBusinessDropdown);
  cuisineSelect.addEventListener("change", updateBusinessDropdown);

  document.getElementById("selector-form").addEventListener("submit", e => {
    e.preventDefault();

    const biz = businessSelect.value;
    if (!biz) return;

    widgetBizName.textContent = biz;

    bizLogo.src = biz === "Star Of Bengal" ? "starofbengal.png" : "greenchilli.png";

    widgetStar.style.display = "none";
    widgetGreen.style.display = "none";

    if (biz === "Star Of Bengal") widgetStar.style.display = "block";
    if (biz === "Green Chilli") widgetGreen.style.display = "block";

    document.getElementById("scratch-lock").style.display = "flex";

    widgetSection.classList.remove("hidden");
    widgetSection.scrollIntoView({ behavior: "smooth" });
  });

  /*  
    ðŸ”“ UNLOCK LOGIC  
    Unlocks when the login widget shows:
      - "That's You In"
      - "Start Scratching"
  */
  const observer = new MutationObserver(() => {
    const loginWidget = document.querySelector(
      ".commonninja_component.pid-db61f090-e9fa-4a14-9388-05403a74f5db"
    );

    if (!loginWidget) return;

    const text = loginWidget.innerText;

    if (text.includes("That's You In") || text.includes("Start Scratching")) {
      const lock = document.getElementById("scratch-lock");
      if (lock) lock.style.display = "none";
    }
  });

  observer.observe(document.body, { childList: true, subtree: true });
</script>

</body>
</html>
